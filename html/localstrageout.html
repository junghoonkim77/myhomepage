<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
            
       button{
        width : 60px;
       }
       
       .srvalue{
        font-size :13px;
       }
       .delkey {
        font-size: 11px;
           }
       .contents:hover {
            background-color:rgb(191, 231, 191);
        }
        .container {
            width :100%;
            display:grid;
            grid-template-columns: 3fr 1fr;
        }
        .div2{
            font-size :10px;
            background-color: rgb(171, 165, 165);}

    </style>
    <title>로컬아웃풋</title>
</head>
<body>
    
 <div class="container">
  <div class="div1">
    <h4>상담메모 <button class="hiddenShow" style="font-size:12px;">전체로컬보기</button></h4>
  </div>
  <div class="div2" style="display:none;">
    <h4>저장된 전체값</h4>
    <table>

    </table>
  </div>
 </div>
  
 <script>
    jQuery(function(){
        class LocalObj {
            constructor(_$num,_$localval,_$KEY){
             this.$num = _$num;
             this.$localval =_$localval;
             this.$KEY =_$KEY
            }
        }

        
        var $dblength = localStorage.length;
        var $dbArr =[];
        for ( var localkey in localStorage){
           var $memoDbkey =  localkey.slice(0,4);
           var $numKey = localkey.slice(4,localkey.indexOf('^'));
           var values = localStorage.getItem(localkey);
            if(values !=="" && $memoDbkey=="MEMO"){
             $dbArr.push(new LocalObj($numKey,values,localkey) ) ;
              }  
        } // for문 끝 

            $dbArr.sort((a,b)=>a['$num']-b['$num'])
            
            for ( var i =0 ; i<$dbArr.length; i++){
            $('.div1').
           append(`
            <button class="delkey" data-key="${$dbArr[i].$KEY}">삭제[${i}]</button>
            <div class="srvalue">
            <div style="color:blue;font-weight: bold;">순서[${i}] 제목 :${$dbArr[i].$localval.slice(0,4)}</div>
            <div class="contents" style="cursor:pointer">${$dbArr[i].$localval}</div>
            </div><br>
            `);  
            }
            
            for ( k in localStorage){
                $('.div2 table').append(
                `<tr><td>${k}</td><td>${localStorage.getItem(k)}</td></tr>`)
            }
            
      
        $('.hiddenShow').click(function(){
            $(this).toggleClass('localshow');
            if ($(this).hasClass('localshow')){
                $(this).text('로컬DB숨기기');
                $('.div2').show()
            }else{
                $(this).text('전체로컬보기');
                $('.div2').hide(); 
        }
        })

        
        var $delkey =$('.delkey');      
         $delkey.click(function(){
            var $delkeyVal = $(this).attr('data-key');
             localStorage.removeItem($delkeyVal);
            location.reload();
        })
         
       
         var $content = $('.contents');
         $content.click(function(){
         var $thisconTent = $(this).text()
         navigator.clipboard.writeText($thisconTent);
         })

         for ( emptyKey in localStorage){
            if(localStorage.getItem(emptyKey)==""){
                localStorage.removeItem(emptyKey)
            }
            
         }
     })
 </script>

</body>
</html>
